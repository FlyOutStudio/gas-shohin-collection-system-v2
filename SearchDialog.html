<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    body { font-family: sans-serif; padding: 10px; }
    #keyword { width: 95%; padding: 8px; margin-bottom: 10px; }
    #submitBtn { padding: 8px 16px; }
    #status { margin-top: 15px; font-style: italic; color: #555; }
  </style>
</head>
<body>
  <h3>èª¿æŸ»ã—ãŸã„å•†å“ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</h3>
  <input type="text" id="keyword" placeholder="ä¾‹ï¼šã‚¬ãƒ¼ãƒ‡ãƒ³ãƒ©ã‚¤ãƒˆ ã‚½ãƒ¼ãƒ©ãƒ¼">
  <div style="margin: 10px 0;">
    <button id="submitBtn" onclick="search()">æƒ…å ±ã‚’åé›†</button>
    <button id="fullAutoBtn" onclick="fullAutoSearch()" style="background-color: #4CAF50; color: white; margin-left: 10px;">ğŸš€ ãƒ•ãƒ«è‡ªå‹•èª¿æŸ»</button>
  </div>
  <div id="status"></div>

  <script>
    function search() {
      const keyword = document.getElementById('keyword').value.trim();
      if (!keyword) {
        alert('ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
      }
      document.getElementById('submitBtn').disabled = true;
      document.getElementById('status').innerText = 'æƒ…å ±åé›†ä¸­ã§ã™...';

      google.script.run
        .withSuccessHandler(() => google.script.host.close())
        .withFailureHandler(err => {
          alert('ã‚¨ãƒ©ãƒ¼: ' + err.message);
          google.script.host.close();
        })
        .searchProducts(keyword);
    }

    function fullAutoSearch() {
      const keyword = document.getElementById('keyword').value.trim();
      if (!keyword) {
        alert('ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
      }
      
      if (!confirm('ãƒ•ãƒ«è‡ªå‹•èª¿æŸ»ã‚’é–‹å§‹ã—ã¾ã™ã€‚\næ¤œç´¢â†’ã‚¹ã‚¯ã‚·ãƒ§â†’PDFä½œæˆã¾ã§æ•°åˆ†ã‹ã‹ã‚Šã¾ã™ã€‚\nå®Ÿè¡Œä¸­ã¯ä»–ã®ä½œæ¥­ã‚’ã—ã¦ã„ã¦å¤§ä¸ˆå¤«ã§ã™ã€‚\n\nç¶šè¡Œã—ã¾ã™ã‹ï¼Ÿ')) {
        return;
      }
      
      document.getElementById('submitBtn').disabled = true;
      document.getElementById('fullAutoBtn').disabled = true;
      document.getElementById('status').innerText = 'ğŸš€ ãƒ•ãƒ«è‡ªå‹•èª¿æŸ»ã‚’é–‹å§‹ã—ã¾ã—ãŸ...';

      google.script.run
        .withSuccessHandler(() => {
          alert('ãƒ•ãƒ«è‡ªå‹•èª¿æŸ»ãŒé–‹å§‹ã•ã‚Œã¾ã—ãŸï¼\nå®Œäº†ã¾ã§ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„ã€‚');
          google.script.host.close();
        })
        .withFailureHandler(err => {
          alert('ã‚¨ãƒ©ãƒ¼: ' + err.message);
          google.script.host.close();
        })
        .runFullAutoSearch(keyword);
    }
  </script>
</body>
</html>
